/*
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
    MGnify/nf-ftp-fetcher Nextflow config file
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
    Default config options for all compute environments
----------------------------------------------------------------------------------------
*/

params {
    // FTP_FETCH module parameters
    url                        = null
    checksum                   = ''
    checksum_url               = ''
    outdir                     = "${launchDir}/results"
    publish_dir_mode           = 'copy'
    monochrome_logs            = false
}

// Load base.config by default for all pipelines
includeConfig 'conf/base.config'

// Default: Docker + Wave (auto-builds containers from conda environment.yml specs)
docker.enabled          = true
docker.runOptions       = '-u $(id -u):$(id -g)'
wave.enabled            = true
wave.strategy           = ['conda']

profiles {
    debug {
        dumpHashes              = true
        process.beforeScript    = 'echo $HOSTNAME'
        cleanup                 = false
        nextflow.enable.configProcessNamesValidation = true
    }
    singularity {
        docker.enabled          = false
        singularity.enabled     = true
        singularity.autoMounts  = true
    }
    apptainer {
        docker.enabled          = false
        apptainer.enabled       = true
        apptainer.autoMounts    = true
    }
    conda {
        docker.enabled          = false
        wave.enabled            = false
        conda.enabled           = true
        conda.channels          = ['conda-forge', 'bioconda']
    }
    test      { includeConfig 'conf/test.config'      }
}

// Set default registry for Apptainer, Docker, Podman, Charliecloud and Singularity independent of -profile
apptainer.registry    = 'quay.io'
docker.registry       = 'quay.io'
singularity.registry  = 'quay.io'

// Set bash options
process.shell = [
    "bash",
    "-C",         // No clobber
    "-e",         // Exit on error
    "-u",         // Treat unset variables as error
    "-o",         // Returns the status of the last command to exit..
    "pipefail"    //   ..with a non-zero status or zero if all successfully execute
]

// Disable process selector warnings by default. Use debug profile to enable warnings.
nextflow.enable.configProcessNamesValidation = false

manifest {
    name            = 'MGnify/nf-ftp-fetcher'
    contributors    = [
        [
            name: 'Timothy Rozday',
            affiliation: '',
            email: '',
            github: '',
            contribution: [],
            orcid: ''
        ],
    ]
    homePage        = 'https://github.com/MGnify/nf-ftp-fetcher'
    description     = """Nextflow module for fetching files via FTP with resilient retry handling"""
    mainScript      = 'main.nf'
    defaultBranch   = 'main'
    nextflowVersion = '!>=25.04.0'
    version         = '1.0.0dev'
}

// Load modules.config for DSL2 module specific options
includeConfig 'conf/modules.config'
